# 简化定时架构说明

## 🎯 架构变更

我们已经移除了GitHub Actions定时触发器，现在使用**单一外部定时服务**架构，更加简洁可靠。

## 🏗️ 当前架构

### 定时触发
- **服务**: cron-job.org (免费)
- **时间**: 每天UTC 01:00
- **方式**: HTTP POST请求到 `/scheduled` 端点
- **优势**: 
  - 独立于代码仓库
  - 免费且可靠
  - 配置简单
  - 无需维护GitHub Actions

### 数据流程
```
外部定时服务 → scheduled.js → 数据抓取 → KV存储 → 用户访问
```

## 🔧 配置要求

### 外部定时服务设置
1. **URL**: `https://nyt-connections-helper.pages.dev/scheduled`
2. **方法**: POST
3. **Headers**: `Content-Type: application/json`
4. **Body**: 
```json
{
  "action": "daily-update",
  "secret": "your-secret-key"
}
```
5. **时间**: `0 1 * * *` (UTC)

## 📋 优势对比

### 之前（双重触发）
- ✅ 冗余备份
- ❌ 复杂配置
- ❌ 依赖GitHub
- ❌ 可能重复执行

### 现在（单一触发）
- ✅ 架构简洁
- ✅ 独立运行
- ✅ 配置简单
- ✅ 无重复执行
- ✅ 更好的可控性

## 🚀 手动触发

如果需要手动触发更新：

```bash
curl -X POST https://nyt-connections-helper.pages.dev/scheduled \
  -H "Content-Type: application/json" \
  -d '{"action":"daily-update","secret":"your-secret"}'
```

或者使用refresh API：
```bash
curl -X POST https://nyt-connections-helper.pages.dev/api/refresh
```

## 📊 监控

### 检查定时任务状态
1. 登录 cron-job.org
2. 查看执行历史
3. 确认状态为成功

### 验证数据更新
1. 访问 `/api/today`
2. 检查数据源和时间戳
3. 确认不是备用数据

## 🔍 故障排除

### 如果定时任务失败
1. 检查cron-job.org执行日志
2. 验证URL和请求格式
3. 检查secret密钥是否正确

### 如果数据没更新
1. 手动触发scheduled端点
2. 检查Cloudflare Functions日志
3. 验证解析逻辑是否正常

这个简化架构更加稳定可靠，减少了维护复杂度。